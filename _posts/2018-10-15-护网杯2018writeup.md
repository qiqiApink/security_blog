---
layout: post
title: 2018 æŠ¤ç½‘æ¯ Writeup
date: 2018-10-15
author: Qiqi
header-img: img/ef2bc57ab959_e-978x727.png
catalog: true
tag:
   - CTF
   - Writeup
---

# 2018 æŠ¤ç½‘æ¯ writeup

åˆ’äº†å¥½ä¹…çš„æ°´ï¼Œå½“ç„¶è¿™æ¬¡æ¯”èµ›ä¾æ—§åˆ’æ°´ï¼Œæš‘å‡è¿‡çš„è¿‡äºå®‰é€¸äº†ï¼Œå¼€å­¦ä¹Ÿå·²ç»ä¸€ä¸ªæœˆäº†ï¼Œè¯¥å­¦ä¹ äº†ï½

## web

### easy_tornado

tornadoæ¨¡ç‰ˆæ³¨å…¥

æ­£å¸¸urlï¼š`/file?filename=flag.txt&signature=0b9c8664c389db9d5f87d6f38c317514`

æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªé”™è¯¯çš„ç­¾åçš„æ—¶å€™ï¼Œå°±ä¼šè·³è½¬è‡³`/error?msg=ç­¾åé”™è¯¯`

è¿™é‡Œçš„`msg`å‚æ•°å°±æ˜¯æ³¨å…¥ç‚¹

![](https://ws1.sinaimg.cn/large/006Vib6xly1fw6suq76euj30cu03dq3d.jpg)

æ ¹æ®æç¤º`md5(cookie_secret + md5(filename))`æˆ‘ä»¬è¦å¯»æ‰¾`cookie_secret`ï¼Œåœ¨`settings`ä¸­

å°è¯•`requestHandler`ç­‰ç­‰éƒ½ä¸è¡Œ

æœ€åå°è¯•`handler.settings`æˆåŠŸæ‹¿åˆ°`cookie_secret`ä¸º`pf4x#.OmAiR1qNLkbT$XU_zIj3e>J8DMn~B^]7(sYl*VCQS[?9}ga)-cFG%&!vu+`

å†æ ¹æ®`flag.txt`ç»™çš„`/fllllllllllag`

è®¿é—®`/file?filename=/fllllllllllag&signature=faf5c748cd11c3f38115ccb0782646f7`

å¾—åˆ°flagï¼š`flag{e9c5d160a9fba25ea3f3874285db2db4}`

### ltshop

æˆ‘ä»¬å¯ä»¥è´­ä¹°è¾£æ¡ï¼Œä½†æ˜¯åªèƒ½è´­ä¹°å››ä¸ªï¼Œå› ä¸ºæ˜¯æ‰¹é‡å…‘æ¢ï¼Œæ‰€ä»¥è‡³å°‘åä¸ªæ‰èƒ½å…‘æ¢è¾£æ¡ç‹

å¯ä»¥é€šè¿‡æ¡ä»¶ç«äº‰ï¼Œä¸€æ¬¡å‘å¤šä¸ªåŒ…ï¼Œè¿™æ ·æˆ‘ä»¬è´­ä¹°ä¸€æ¬¡å°±èƒ½è·å¾—å¤šä¸ªè¾£æ¡

![](https://ws1.sinaimg.cn/large/006Vib6xly1fw6t49j2b9j309l06b74m.jpg)

åƒè¿™æ ·

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å»å…‘æ¢è¾£æ¡ç‹äº†ï¼Œä½†æ˜¯å…‘æ¢flagéœ€è¦9999999ä¸ªè¾£æ¡ç‹ï¼Œä»…ä»…é€šè¿‡æ¡ä»¶ç«äº‰æ˜¯è¿œè¿œä¸å¤Ÿçš„

è¿™é‡Œæˆ‘ä»¬æœ‰å¯ä»¥æ§åˆ¶çš„numberå‚æ•°ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°å¤§æ•´æ•°æº¢å‡º

æˆ‘ä»¬åœ¨`cookie`çš„åœ°æ–¹çœ‹åˆ°`go_iris_cookie`ï¼Œåº”è¯¥æ˜¯goè¯­è¨€å†™çš„ï¼ŒæŸ¥ä¸€ä¸‹èµ„æ–™ï¼Œ`unsigned __int64çš„æœ€å¤§å€¼ï¼š18446744073709551615`

å› ä¸ºäº”ä¸ªè¾£æ¡å…‘æ¢ä¸€ä¸ªè¾£æ¡ç‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å…¶é™¤ä»¥5ï¼ŒåŒæ—¶æˆ‘ä»¬è¦è®©å®ƒæº¢å‡ºï¼Œè¿˜è¦èƒ½å¤Ÿä¹°çš„èµ·ï¼Œæ‰€ä»¥æˆ‘ä»¬å†åŠ 1æˆ–è€…2

æ‰€ä»¥æˆ‘ä»¬è®©`number=3689348814741910324`æˆ–è€…`number=3689348814741910325`

æˆåŠŸè´­ä¹°`{"message":3689348814741910324,"status":"succeed"}`

![](https://ws1.sinaimg.cn/large/006Vib6xly1fw6tlmro9qj30ct06ejru.jpg)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¾£æ¡ä¹‹ç‹çš„æ•°ç›®å·²ç»è¿œè¿œè¶…è¿‡æ‰€éœ€è¦çš„äº†

ç›´æ¥å…‘æ¢flagï¼Œå¾—åˆ°

![](https://ws1.sinaimg.cn/large/006Vib6xly1fw6tmhmmx2j30bw067q42.jpg)

## Misc

### è¿Ÿæ¥çš„ç­¾åˆ°é¢˜

é¢˜ç›®æ˜¯ä¸€ä¸²base64ï¼Œè§£ç å¾—åˆ°`PR S%PP#TU"^V%R'RSV VT_VQ'WVSW_Q`

å‘ç°æ˜¯ä¹±ç ï¼Œäºæ˜¯è”æƒ³åˆ°é¢˜ç›®æç¤ºçš„xorï¼Œæ‰€ä»¥å†™ä¸ªè„šæœ¬çˆ†ç ´ä¸€ä¸‹

```python
import base64

str = 'AAoHAR1QUiBTJVBQI1RVIl5WJVInUlNWIFZUX1ZRJ1dWU1dfURs='
str = base64.b64decode(str)
flag = ''
for i in range(255):
    for j in str:
        flag += chr(ord(j) ^ i)
    print flag
    flag = ''
```

å…¶ä¸­ä¸€ä¸²æ˜¯`flag{64F5C66E23D80C4A450F02907A105197}`

## Crypto

### FEZ

**fez.py**

```python
import os
def xor(a,b):
    assert len(a)==len(b)
    c=""
    for i in range(len(a)):
        c+=chr(ord(a[i])^ord(b[i]))
    return c
def f(x,k):
    return xor(xor(x,k),7)
def round(M,K):
    L=M[0:27]
    R=M[27:54]
    new_l=R
    new_r=xor(xor(R,L),K)
    return new_l+new_r
def fez(m,K):
    for i in K:
        m=round(m,i)
    return m

K=[]
for i in range(7):
    K.append(os.urandom(27))
m=open("flag","rb").read()
assert len(m)<54
m+=os.urandom(54-len(m))

test=os.urandom(54)
print test.encode("hex")
print fez(test,K).encode("hex")
print fez(m,K).encode("hex")
```

è¿˜é™„ä¸Šäº†ä¸‰ä¸ªè¾“å‡º

```
2315d80c2dd73098953686be6c82aa63c1d362eb0095e4621cce28bec4c921ce016afc7f39fd93b14b6c28ce69c7096b91fd2db0862d

308e590a180473ab4d23a0c67b65fe2bf2d0a9f1b255e4e2610b0c90e8e210c8ed4f2b9a3b09c1886a781f94fee4f77488c0b30f2395

e822e918e578a7af4f0859a99aab5d7563644beb4207a73d5fc4560d3deb696320cec479431a4f724310499baf5230db7e56764915d0
```

æˆ‘ä»¬é¦–å…ˆæŠŠä»£ç çœ‹æ‡‚ï¼Œæœ€é‡è¦çš„å°±æ˜¯`round()`å‡½æ•°ï¼Œæˆ‘ä»¬å°†åŸæ¥çš„å·¦åŠè¾¹å½“ä½œæ–°çš„å³åŠè¾¹ï¼ŒæŠŠå·¦åŠè¾¹å¼‚æˆ–ä¸Šå³åŠè¾¹åœ¨å¼‚æˆ–ä¸Škä½œä¸ºæ–°çš„å³åŠè¾¹

æˆ‘ä»¬å‡è®¾testçš„å·¦åŠè¾¹æ˜¯Lï¼Œå³åŠè¾¹æ˜¯Rï¼Œå› ä¸ºKçš„é•¿åº¦æ˜¯7

æ‰€ä»¥å¦‚æœè®¡ç®—`fez(test,K)`ï¼Œåˆ™æœ‰ä»¥ä¸‹è¿‡ç¨‹ï¼š

```
åˆå§‹: L  R
1: R  L^R^k1
2: L^R^k1  L^k1^k2
3: L^k1^k2  R^k2^k3
4: R^k2^k3  L^R^k1^k3^k4
5: L^R^k1^k3^k4  L^k1^k2^k4^k5
6: L^k1^k2^k4^k5  R^k2^k3^k5^k6
7: R^k2^k3^k5^k6  L^R^k1^k3^k4^k6^k7
```

è€Œ`R^k2^k3^k5^k6 + L^R^k1^k3^k4^k6^k7`å†hexç¼–ç ä¹‹åå…¶å®å°±æ˜¯ç¬¬äºŒä¸ªè¾“å‡º

åŒç†ï¼Œå‡è®¾mçš„å·¦åŠè¾¹æ˜¯m1ï¼Œmçš„å³åŠè¾¹æ˜¯m2

`m1' = m2^k2^k3^k5^k6`ï¼Œ`m2' = m1^m2^k1^k3^k4^k6^k7`

æ‰€ä»¥`m = m2'^R'^m1'^L^L' + m1'^L'^R`

```python
def xor(a,b):
    assert len(a)==len(b)
    c=""
    for i in range(len(a)):
        c+=chr(ord(a[i])^ord(b[i]))
    return c

test = '2315d80c2dd73098953686be6c82aa63c1d362eb0095e4621cce28bec4c921ce016afc7f39fd93b14b6c28ce69c7096b91fd2db0862d'.decode("hex")
fez1 = '308e590a180473ab4d23a0c67b65fe2bf2d0a9f1b255e4e2610b0c90e8e210c8ed4f2b9a3b09c1886a781f94fee4f77488c0b30f2395'.decode("hex")
fez2 = 'e822e918e578a7af4f0859a99aab5d7563644beb4207a73d5fc4560d3deb696320cec479431a4f724310499baf5230db7e56764915d0'.decode("hex")

L = test[0:27]
R = test[27:54]

L1 = fez1[0:27]
R1 = fez1[27:54]

m1 = fez2[0:27]
m2 = fez2[27:54]

m = xor(xor(xor(xor(m2, R1), m1), L), L1) + xor(xor(m1, L1), R)
print m
```

å¾—åˆ°flagï¼š`flag{festel_weak_666_11xd77fhy33}`
